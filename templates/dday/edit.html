{% extends "base.html" %}

{% block title %}D-Day ìˆ˜ì • - ì»¤í”Œ ì•±{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h1>ğŸ“… D-Day ìˆ˜ì •</h1>
        <p>D-Day ì •ë³´ë¥¼ ìˆ˜ì •í•´ë³´ì„¸ìš”</p>
    </div>

    <div class="form-card">
        <form method="POST" class="dday-form">
            <div class="form-group">
                <label for="title">ì œëª© *</label>
                <input type="text" 
                       id="title" 
                       name="title" 
                       value="{{ dday.title }}"
                       placeholder="ì˜ˆ: ìš°ë¦¬ 1ì£¼ë…„, ìƒì¼, ì—¬í–‰ ë“±"
                       required
                       maxlength="100">
                <div class="form-help">D-Dayì˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ìµœëŒ€ 100ì)</div>
            </div>

            <div class="form-group">
                <label for="target_date">ë‚ ì§œ *</label>
                <input type="date" 
                       id="target_date" 
                       name="target_date" 
                       value="{{ dday.target_date.strftime('%Y-%m-%d') }}"
                       required>
                <div class="form-help">D-Dayë¡œ ì„¤ì •í•  ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
            </div>

            <div class="form-group">
                <label for="description">ì„¤ëª…</label>
                <textarea id="description" 
                          name="description" 
                          rows="4" 
                          placeholder="ì´ ë‚ ì— ëŒ€í•œ íŠ¹ë³„í•œ ì˜ë¯¸ë‚˜ ê³„íšì„ ì ì–´ë³´ì„¸ìš”"
                          maxlength="500">{{ dday.description or '' }}</textarea>
                <div class="form-help">ì„ íƒì‚¬í•­ (ìµœëŒ€ 500ì)</div>
            </div>

            <div class="form-actions">
                <a href="{{ url_for('dday.index') }}" class="btn btn-secondary">ì·¨ì†Œ</a>
                <button type="submit" class="btn btn-primary">ìˆ˜ì •í•˜ê¸°</button>
            </div>
        </form>
    </div>

    <!-- ë¯¸ë¦¬ë³´ê¸° ì¹´ë“œ -->
    <div class="preview-section">
        <h3>ë¯¸ë¦¬ë³´ê¸°</h3>
        <div class="dday-preview-card">
            <div class="dday-card-header">
                <h3 class="dday-card-title" id="preview-title">{{ dday.title }}</h3>
            </div>
            <div class="dday-card-content">
                <div class="dday-date" id="preview-date">
                    {{ dday.target_date.strftime('%Yë…„ %mì›” %dì¼') }}
                </div>
                <div class="dday-status">
                    <span class="dday-number {% if dday.is_past() %}past{% endif %}" id="preview-status">
                        {{ dday.get_status_text() }}
                    </span>
                </div>
                {% if dday.description %}
                <div class="dday-description" id="preview-description">
                    {{ dday.description }}
                </div>
                {% else %}
                <div class="dday-description" id="preview-description" style="display: none;"></div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* í¼ ì»¨í…Œì´ë„ˆ */
.form-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

.form-header {
    grid-column: 1 / -1;
    text-align: center;
    margin-bottom: var(--spacing-xl);
}

.form-header h1 {
    font-size: var(--text-2xl);
    font-weight: 700;
    color: var(--charcoal);
    margin-bottom: var(--spacing-sm);
}

.form-header p {
    font-size: var(--text-lg);
    color: var(--dark-gray);
}

.form-card {
    background: var(--white);
    padding: var(--spacing-2xl);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-md);
}

.dday-form {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

/* ë¯¸ë¦¬ë³´ê¸° ì„¹ì…˜ */
.preview-section {
    position: sticky;
    top: calc(64px + var(--spacing-lg));
}

.preview-section h3 {
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--charcoal);
    margin-bottom: var(--spacing-lg);
    text-align: center;
}

.dday-preview-card {
    background: var(--white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-md);
    overflow: hidden;
    border-left: 4px solid var(--accent-coral);
}

.dday-preview-card .dday-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--medium-gray);
    background: var(--light-gray);
}

.dday-preview-card .dday-card-title {
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--charcoal);
    margin: 0;
}

.dday-preview-card .dday-card-content {
    padding: var(--spacing-lg);
}

.dday-preview-card .dday-date {
    font-size: var(--text-lg);
    font-weight: 500;
    color: var(--charcoal);
    margin-bottom: var(--spacing-md);
}

.dday-preview-card .dday-status {
    text-align: center;
    margin: var(--spacing-lg) 0;
}

.dday-preview-card .dday-number {
    display: inline-block;
    font-size: var(--text-2xl);
    font-weight: 700;
    color: var(--accent-coral);
    padding: var(--spacing-md) var(--spacing-lg);
    background: linear-gradient(135deg, var(--primary-pink), var(--primary-blue));
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
}

.dday-preview-card .dday-number.past {
    color: var(--dark-gray);
    background: var(--medium-gray);
}

.dday-preview-card .dday-description {
    color: var(--dark-gray);
    line-height: 1.6;
    margin-bottom: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--light-gray);
    border-radius: var(--radius-md);
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
    .form-container {
        grid-template-columns: 1fr;
        gap: var(--spacing-xl);
        padding: 0 var(--spacing-md);
    }
    
    .form-card {
        padding: var(--spacing-xl);
    }
    
    .preview-section {
        position: static;
        order: -1;
    }
    
    .form-header h1 {
        font-size: var(--text-xl);
    }
    
    .form-header p {
        font-size: var(--text-base);
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const titleInput = document.getElementById('title');
    const dateInput = document.getElementById('target_date');
    const descriptionInput = document.getElementById('description');
    
    const previewTitle = document.getElementById('preview-title');
    const previewDate = document.getElementById('preview-date');
    const previewStatus = document.getElementById('preview-status');
    const previewDescription = document.getElementById('preview-description');
    
    // ì œëª© ì…ë ¥ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    titleInput.addEventListener('input', function() {
        const title = this.value.trim();
        previewTitle.textContent = title || 'D-Day ì œëª©';
    });
    
    // ë‚ ì§œ ì…ë ¥ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    dateInput.addEventListener('change', function() {
        const selectedDate = this.value;
        if (selectedDate) {
            const date = new Date(selectedDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            date.setHours(0, 0, 0, 0);
            
            // ë‚ ì§œ í¬ë§·íŒ…
            const formattedDate = date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            previewDate.textContent = formattedDate;
            
            // D-Day ê³„ì‚°
            const diffTime = date - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            let statusText;
            if (diffDays > 0) {
                statusText = `D-${diffDays}`;
            } else if (diffDays === 0) {
                statusText = 'D-Day';
            } else {
                statusText = `D+${Math.abs(diffDays)}`;
            }
            
            previewStatus.textContent = statusText;
            
            // ê³¼ê±° ë‚ ì§œì¸ ê²½ìš° ìŠ¤íƒ€ì¼ ë³€ê²½
            if (diffDays < 0) {
                previewStatus.classList.add('past');
            } else {
                previewStatus.classList.remove('past');
            }
        }
    });
    
    // ì„¤ëª… ì…ë ¥ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    descriptionInput.addEventListener('input', function() {
        const description = this.value.trim();
        if (description) {
            previewDescription.textContent = description;
            previewDescription.style.display = 'block';
        } else {
            previewDescription.style.display = 'none';
        }
    });
    
    // í¼ ê²€ì¦
    document.querySelector('.dday-form').addEventListener('submit', function(e) {
        const title = titleInput.value.trim();
        const targetDate = dateInput.value;
        
        if (!title) {
            e.preventDefault();
            showToast('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            titleInput.focus();
            return;
        }
        
        if (!targetDate) {
            e.preventDefault();
            showToast('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
            dateInput.focus();
            return;
        }
    });
});
</script>
{% endblock %}